<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n tr·ªã - Forum</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">
      <a href="home.html" class="nav-brand" >Trang ch·ªß</a>
    </div>
  </nav>

  <main class="container">
    <h1>üõ†Ô∏è Qu·∫£n l√Ω b√†i vi·∫øt ch·ªù duy·ªát</h1>
    <div id="pending-posts" class="post-list">ƒêang t·∫£i...</div>
  </main>
  <script src="theme.js"></script>
  <script src="app.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", loadPendingPosts);
async function loadPendingPosts() {
  const res = await fetch("/admin/pending", {
    headers: { "Authorization": `Bearer ${localStorage.getItem("token")}` }
  });
  const posts = await res.json();

  const container = document.getElementById("pending-posts");
  container.innerHTML = posts.length
    ? posts.map(p => `
      <div class="post-card">
        <h3>${p.title}</h3>
        <p>${p.content}</p>
        <small>üë§ ${p.author?.username || "·∫®n danh"}</small><br>
        
        <div class="admin-buttons">
          <button onclick="approvePost('${p._id}')">‚úÖ Duy·ªát</button>
          <button onclick="rejectPost('${p._id}')">‚ùå X√≥a</button>
        </div>
      </div>
    `).join("")
    : "<p>Kh√¥ng c√≥ b√†i n√†o ch·ªù duy·ªát.</p>";
}

async function approvePost(id) {
  await fetch(`/admin/approve/${id}`, {
    method: "PUT",
    headers: { "Authorization": `Bearer ${localStorage.getItem("token")}` }
  });
  loadPendingPosts();
}

async function rejectPost(id) {
  await fetch(`/admin/reject/${id}`, {
    method: "DELETE",
    headers: { "Authorization": `Bearer ${localStorage.getItem("token")}` }
  });
  loadPendingPosts();
}

document.addEventListener("DOMContentLoaded", loadPendingPosts);
  async function deletePost(id, btn) {
    const token = localStorage.getItem("token");
    if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i n√†y?")) return;
    try {
      const res = await fetch(`/admin/post/${id}`, {
        method: "DELETE",
        headers: { "Authorization": "Bearer " + token },
      });
      if (res.ok) {
        btn.closest(".post-card").remove();
      } else {
        alert("Kh√¥ng th·ªÉ x√≥a b√†i.");
      }
    } catch {
      alert("L·ªói k·∫øt n·ªëi server.");
    }
  }
  </script>
</body>
</html>
