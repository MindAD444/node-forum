<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chọn tên người dùng</title>
  <link rel="stylesheet" href="style.css" />
  <script src="theme.js" defer></script>
</head>
<body>

<main class="form-container">
  <h1>Chọn tên người dùng</h1>

  <p>Vui lòng chọn một tên để hoàn tất đăng nhập:</p>

  <input type="text" id="username" placeholder="Nhập tên bạn muốn" required autocomplete="off" />
  <button id="confirm-btn">Xác nhận</button>

  <p id="message"></p>
</main>

<script>
const pending = JSON.parse(localStorage.getItem("pendingUser"));
if (!pending) location.href = "login.html";

document.getElementById("confirm-btn").onclick = async () => {
  const username = document.getElementById("username").value.trim();

  if (!username) return document.getElementById("message").textContent = "Tên không được bỏ trống.";

  const res = await fetch("/auth/set-username", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email: pending.email, googleId: pending.googleId, username })
  });

  const data = await res.json();

  if (res.ok) {
    localStorage.removeItem("pendingUser");
    location.href = "home.html";
  } else {
    document.getElementById("message").textContent = data.error;
  }
};
</script>

</body>
</html>
